# DatingClient

ะัะพััะฟะปะฐััะพัะผะตะฝะฝะพะต ะผะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต ะดะปั ะทะฝะฐะบะพะผััะฒ, ัะฐะทัะฐะฑะพัะฐะฝะฝะพะต ะฝะฐ ะฑะฐะทะต **MAUI (.NET 8.0)** ั ะฟะพะดะดะตัะถะบะพะน iOS, Android.

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะะฑะทะพั](#ะพะฑะทะพั)
- [ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ](#ัะตัะฝะพะปะพะณะธัะตัะบะธะน-ััะตะบ)
- [ะััะธัะตะบัััะฐ](#ะฐััะธัะตะบัััะฐ)
- [ะกัััะบัััะฐ ะฟัะพะตะบัะฐ](#ััััะบัััะฐ-ะฟัะพะตะบัะฐ)
- [ะขัะตะฑะพะฒะฐะฝะธั ะบ ัะธััะตะผะต](#ััะตะฑะพะฒะฐะฝะธั-ะบ-ัะธััะตะผะต)
- [ะฃััะฐะฝะพะฒะบะฐ ะธ ะฝะฐัััะพะนะบะฐ](#ัััะฐะฝะพะฒะบะฐ-ะธ-ะฝะฐัััะพะนะบะฐ)
- [ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ](#ะพัะฝะพะฒะฝัะต-ะฒะพะทะผะพะถะฝะพััะธ)
- [ะััะธัะตะบัััะฐ ัะตัะฒะธัะพะฒ](#ะฐััะธัะตะบัััะฐ-ะธ-ัะตัะฒะธัั-ะดะฐะฝะฝัั)
- [ViewModel ะฟะฐััะตัะฝ](#viewmodel-ะฟะฐััะตัะฝ-ะธ-ะฟัะธะฒัะทะบะฐ-ะดะฐะฝะฝัั)
- [ะะพัะพะบะธ ะดะฐะฝะฝัั](#ะฟะพัะพะบ-ะดะฐะฝะฝัั-ะธ-ัะธะฝััะพะฝะธะทะฐัะธั)
- [ะะตะบะพะผะตะฝะดะฐัะธะธ](#ัะตะบะพะผะตะฝะดะฐัะธะธ-ะฟะพ-ะพะฟัะธะผะธะทะฐัะธะธ)
- [Build ะธ ัะฐะทะฒะตัััะฒะฐะฝะธะต](#Build-ะธ-ัะฐะทะฒะตัััะฒะฐะฝะธะต)

**๐ ะะพะฟะพะปะฝะธัะตะปัะฝะพ:** ัะผ. [`README_EXTENDED.md`](README_EXTENDED.md) ะดะปั ะฟะพะดัะพะฑะฝัั ะฟัะธะผะตัะพะฒ ะบะพะดะฐ ะธ ัะตัะตะฝะธั ะฟัะพะฑะปะตะผ

## ะะฑะทะพั

**DatingClient** โ ััะพ ะฟะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต ะดะปั ะทะฝะฐะบะพะผััะฒ ั ะธะฝััะธัะธะฒะฝัะผ ะธะฝัะตััะตะนัะพะผ ะธ ัะพะฒัะตะผะตะฝะฝะพะน ะฐััะธัะตะบัััะพะน. ะัะธะปะพะถะตะฝะธะต ะฟะพะทะฒะพะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปัะผ:

- ๐ ะะฒัะพัะธะทะพะฒะฐัััั ะธ ัะฟัะฐะฒะปััั ะฟัะพัะธะปะตะผ
- ๐ฅ ะัะพัะผะฐััะธะฒะฐัั ะฟัะพัะธะปะธ ะดััะณะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ั ะฟัะธะผะตะฝะตะฝะธะตะผ ัะธะปัััะพะฒ
- โค๏ธ ะะฐะนะบะฐัั ะธ ะฟัะพัะผะฐััะธะฒะฐัั ะฟะพะปััะตะฝะฝัะต ะปะฐะนะบะธ
- ๐ฌ ะะฑัะฐัััั ะฒ ัะฐัะฐั ั ะดััะณะธะผะธ ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- ๐จ ะฃะฟัะฐะฒะปััั ะฟะฐัะฐะผะตััะฐะผะธ ะฟัะพัะธะปั
- ๐๏ธ ะััะธัะพะฒะฐัั ะฐะฒะฐัะฐัั ะธ ะดะฐะฝะฝัะต ะฟัะพัะธะปะตะน

## ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

### ะัะฝะพะฒะฝัะต ััะตะนะผะฒะพัะบะธ ะธ ะฑะธะฑะปะธะพัะตะบะธ:

| ะะพะผะฟะพะฝะตะฝั                 | ะะตััะธั  | ะะฐะทะฝะฐัะตะฝะธะต                       |
| ------------------------- | ------- | -------------------------------- |
| **.NET**                  | 8.0     | ะะปะฐััะพัะผะฐ ัะฐะทัะฐะฑะพัะบะธ             |
| **MAUI**                  | Latest  | ะัะพััะฟะปะฐััะพัะผะตะฝะฝัะน UI ััะตะนะผะฒะพัะบ  |
| **CommunityToolkit.Maui** | 9.1.1   | ะะฐััะธัะตะฝะฝัะต MAUI ะบะพะผะฟะพะฝะตะฝัั      |
| **CommunityToolkit.MVVM** | 8.3.0   | MVVM ะฟะฐััะตัะฝั ะธ ะธะฝััััะผะตะฝัั      |
| **Newtonsoft.Json**       | 13.0.3  | JSON ัะตัะธะฐะปะธะทะฐัะธั/ะดะตัะตัะธะฐะปะธะทะฐัะธั |
| **sqlite-net-pcl**        | 1.9.172 | ะะพะบะฐะปัะฝะพะต ััะฐะฝะธะปะธัะต ะดะฐะฝะฝัั       |

### ะฆะตะปะตะฒัะต ะฟะปะฐััะพัะผั:

- ๐ค **Android** 5.0+
- ๐ **iOS** 11.0+

## ะััะธัะตะบัััะฐ

ะัะพะตะบั ะธัะฟะพะปัะทัะตั ะฟะฐััะตัะฝ **MVVM (Model-View-ViewModel)** ั ะฟัะธะฝัะธะฟะฐะผะธ ัะฐะทะดะตะปะตะฝะธั ะพัะฒะตัััะฒะตะฝะฝะพััะธ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           User Interface                โ
โ    (Views: XAML + Code-Behind)          โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        ViewModel Layer                   โ
โ  (Business Logic, State Management)      โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        Services Layer                    โ
โ (ApiService, SocketService, CacheService)
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      Models & Data Access                โ
โ    (SQLite, REST API, WebSocket)         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
DatingClient/
โโโ ๐ App.xaml                    # ะขะพัะบะฐ ะฒัะพะดะฐ ะฟัะธะปะพะถะตะฝะธั
โโโ ๐ App.xaml.cs                 # ะะพะณะธะบะฐ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ
โโโ ๐ AppShell.xaml               # ะะฐัััััะธะทะฐัะธั ะฟัะธะปะพะถะตะฝะธั
โโโ ๐ Constants.cs                # ะะปะพะฑะฐะปัะฝัะต ะบะพะฝััะฐะฝัั
โโโ ๐ MauiProgram.cs              # ะะพะฝัะธะณััะฐัะธั DI ะบะพะฝัะตะนะฝะตัะฐ
โ
โโโ ๐ Converters/                 # XAML ะบะพะฝะฒะตััะตัั
โ   โโโ BoolToColorConverter.cs     # ะะพะฝะฒะตััะฐัะธั bool โ Color
โ   โโโ BoolToLayoutConverter.cs    # ะะพะฝะฒะตััะฐัะธั bool โ StackLayout
โ   โโโ GenderJsonConverter.cs      # JSON ัะตัะธะฐะปะธะทะฐัะธั ะฟะพะปะฐ
โ   โโโ GenderToStringConverter.cs  # Gender โ String
โ   โโโ InverseBoolConverter.cs     # ะะฝะฒะตััะธั boolean
โ   โโโ NullableToBoolConverter.cs  # null โ false ะบะพะฝะฒะตััะฐัะธั
โ
โโโ ๐ Helpers/                    # ะัะฟะพะผะพะณะฐัะตะปัะฝัะต ะบะปะฐััั
โ   โโโ AuthHelper.cs              # ะะฐะฑะพัะฐ ั ะฐััะตะฝัะธัะธะบะฐัะธะตะน
โ   โโโ GenderHelper.cs            # ะะฐะฑะพัะฐ ั ะฟะพะปะพะผ ะฟะพะปัะทะพะฒะฐัะตะปั
โ   โโโ QueryHelper.cs             # ะะพัััะพะตะฝะธะต query ะฟะฐัะฐะผะตััะพะฒ
โ   โโโ StorageHelper.cs           # ะะฐะฑะพัะฐ ั ะปะพะบะฐะปัะฝัะผ ััะฐะฝะธะปะธัะตะผ
โ
โโโ ๐ Models/                     # ะะพะดะตะปะธ ะดะฐะฝะฝัั
โ   โโโ Auth.cs                    # ะััะตะฝัะธัะธะบะฐัะธะพะฝะฝัะต ะดะฐะฝะฝัะต
โ   โโโ ChatSummary.cs             # ะัะฐัะบะฐั ะธะฝัะพัะผะฐัะธั ะพ ัะฐัะต
โ   โโโ IUpdatable.cs              # ะะฝัะตััะตะนั ะพะฑะฝะพะฒะปัะตะผัั ะผะพะดะตะปะตะน
โ   โโโ LocationSuggestion.cs      # ะัะตะดะปะพะถะตะฝะธะต ะผะตััะพะฟะพะปะพะถะตะฝะธั
โ   โโโ Message.cs                 # ะกะพะพะฑัะตะฝะธะต ะฒ ัะฐัะต
โ   โโโ SearchFilter.cs            # ะคะธะปัััั ะฟะพะธัะบะฐ
โ   โโโ User.cs                    # ะะพะปะฝัะน ะฟัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั
โ   โโโ UserProfile.cs             # ะะฐะทะพะฒะฐั ะธะฝัะพัะผะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั
โ   โโโ WSMessage.cs               # WebSocket ัะพะพะฑัะตะฝะธะต
โ
โโโ ๐ Services/                   # ะะธะทะฝะตั-ะปะพะณะธะบะฐ ะธ ัะตัะฒะธัั
โ   โโโ ApiService.cs              # REST API ะบะปะธะตะฝั
โ   โโโ AvatarCacheService.cs      # ะััะธัะพะฒะฐะฝะธะต ะฐะฒะฐัะฐัะพะฒ
โ   โโโ CacheService.cs            # ะะฑัะตะต ะบััะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั
โ   โโโ LocationService.cs         # ะะฐะฑะพัะฐ ั ะณะตะพะปะพะบะฐัะธะตะน
โ   โโโ SocketService.cs           # WebSocket ัะพะตะดะธะฝะตะฝะธะต
โ
โโโ ๐ Utils/                      # ะฃัะธะปะธัั
โ   โโโ LimitedDeque.cs            # ะะฒัััะพัะพะฝะฝัั ะพัะตัะตะดั ั ะปะธะผะธัะพะผ
โ
โโโ ๐ ViewModels/                 # ViewModel ัะปะพะน
โ   โโโ ChatsViewModel.cs          # VM ัะฟะธัะบะฐ ัะฐัะพะฒ
โ   โโโ LikesViewModel.cs          # VM ะปะฐะนะบะพะฒ
โ   โโโ LoginViewModel.cs          # VM ะฐะฒัะพัะธะทะฐัะธะธ
โ   โโโ MessagesViewModel.cs       # VM ัะพะพะฑัะตะฝะธะน ะฒ ัะฐัะต
โ   โโโ ProfilePopupViewModel.cs   # VM ะฟะพะฟะฐะฟ ะฟัะพัะธะปั
โ   โโโ ProfileViewModel.cs        # VM ะฟัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั
โ   โโโ SearchViewModel.cs         # VM ะฟะพะธัะบะฐ ะฟัะพัะธะปะตะน
โ   โโโ SettingsViewModel.cs       # VM ะฝะฐัััะพะตะบ
โ
โโโ ๐ Views/                      # UI ัะปะพะน (XAML + Code-Behind)
โ   โโโ ChatsPage.xaml(.cs)        # ะกััะฐะฝะธัะฐ ัะฐัะพะฒ
โ   โโโ FilterPopup.xaml(.cs)      # ะะพะฟะฐะฟ ัะธะปัััะพะฒ ะฟะพะธัะบะฐ
โ   โโโ LikesPage.xaml(.cs)        # ะกััะฐะฝะธัะฐ ะปะฐะนะบะพะฒ
โ   โโโ LoadingOverlay.xaml(.cs)   # ะะฒะตัะปะตะน ะทะฐะณััะทะบะธ
โ   โโโ LoginPage.xaml(.cs)        # ะกััะฐะฝะธัะฐ ะฒัะพะดะฐ
โ   โโโ MessagesPage.xaml(.cs)     # ะกััะฐะฝะธัะฐ ัะฐัะฐ
โ   โโโ ProfilePage.xaml(.cs)      # ะกััะฐะฝะธัะฐ ะฟัะพัะธะปั
โ   โโโ ProfilePopup.xaml(.cs)     # ะะพะฟะฐะฟ ะฟัะพัะธะปั
โ   โโโ SearchPage.xaml(.cs)       # ะกััะฐะฝะธัะฐ ะฟะพะธัะบะฐ
โ   โโโ SettingsPage.xaml(.cs)     # ะกััะฐะฝะธัะฐ ะฝะฐัััะพะตะบ
โ
โโโ ๐ Resources/                  # ะะตััััั ะฟัะธะปะพะถะตะฝะธั
โ   โโโ AppIcon/                   # ะะบะพะฝะบะธ ะฟัะธะปะพะถะตะฝะธั
โ   โโโ Fonts/                     # ะะพะปัะทะพะฒะฐัะตะปััะบะธะต ััะธััั
โ   โโโ Images/                    # ะะทะพะฑัะฐะถะตะฝะธั
โ   โโโ Raw/                       # ะกัััะต ัะตััััั
โ   โโโ Splash/                    # ะะฐััะฐะฒะบะฐ ะฟัะธะปะพะถะตะฝะธั
โ   โโโ Styles/                    # XAML ััะธะปะธ
โ
โโโ ๐ Platforms/                  # ะะปะฐััะพัะผะตะฝะฝัะน ะบะพะด
โ   โโโ Android/                   # Android ัะฟะตัะธัะธัะตัะบะธะต ัะฐะนะปั
โ   โโโ iOS/                       # iOS ัะฟะตัะธัะธัะตัะบะธะต ัะฐะนะปั
โ
โโโ ๐ Properties/
    โโโ launchSettings.json        # ะะฐัะฐะผะตััั ะทะฐะฟััะบะฐ
```

## ะขัะตะฑะพะฒะฐะฝะธั ะบ ัะธััะตะผะต

### ะะปั ัะฐะทัะฐะฑะพัะบะธ:

- **Visual Studio** ะธะปะธ **Rider**
- **.NET 8.0 SDK**
- **Java Development Kit (JDK)** 11+ (ะดะปั Android)
- **Android SDK** (API Level 21+)
- **Xcode** 14+ (ะดะปั iOS, ััะตะฑัะตััั macOS)

### ะะธะฝะธะผะฐะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั ะฟะปะฐััะพัะผ:

- **Android:** API Level 21 (5.0 Lollipop)
- **iOS:** ะฒะตััะธั 11.0 ะธ ะฒััะต

## ะฃััะฐะฝะพะฒะบะฐ ะธ ะฝะฐัััะพะนะบะฐ

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั

```bash
git clone https://github.com/dmMorsh/DatingClient.git
cd DatingClient
```

### 2. ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพััะตะน

```bash
dotnet restore
```

### 3. ะะฐัััะพะนะบะฐ ะบะพะฝัะธะณััะฐัะธะธ

ะััะตะดะฐะบัะธััะนัะต `Constants.cs` ะธ ัััะฐะฝะพะฒะธัะต URL ะฒะฐัะตะณะพ API ัะตัะฒะตัะฐ:

```csharp
public const string ApiBaseUrl = "http://192.168.0.12:8088";
// ะธะปะธ ะดะปั production
public const string ApiBaseUrl = "https://your-domain.com";
```

### 4. ะกะฑะพัะบะฐ ะฟัะพะตะบัะฐ

```bash
# ะกะฑะพัะบะฐ ะดะปั ะฒัะตั ะฟะปะฐััะพัะผ
dotnet build

# ะะปะธ ะดะปั ะบะพะฝะบัะตัะฝะพะน ะฟะปะฐััะพัะผั
dotnet build -f net8.0-android
dotnet build -f net8.0-ios
```

### 5. ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั

```bash
# Android
dotnet build -t Run -f net8.0-android

# iOS (ััะตะฑัะตััั macOS)
dotnet build -t Run -f net8.0-ios
```

## ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ

### ๐ ะััะตะฝัะธัะธะบะฐัะธั ะธ ัะฟัะฐะฒะปะตะฝะธะต ัะพะบะตะฝะฐะผะธ

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**

- ะะตะณะธัััะฐัะธั ะธ ะฒัะพะด ะฒ ััะตัะฝัั ะทะฐะฟะธัั
- ะฃะฟัะฐะฒะปะตะฝะธะต ัะพะบะตะฝะฐะผะธ ะดะพัััะฟะฐ ะธ refresh ัะพะบะตะฝะฐะผะธ
- ะกะพััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั ัะตะฐะฝัะฐ ะฒ ะปะพะบะฐะปัะฝะพะผ ััะฐะฝะธะปะธัะต
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ัะพะบะตะฝะฐ ะฟัะธ ะธััะตัะตะฝะธะธ

**ะะพะณะธะบะฐ:**

```
ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั credentials
           โ
API ะฒะพะทะฒัะฐัะฐะตั access_token + refresh_token
           โ
ะขะพะบะตะฝั ัะพััะฐะฝััััั ะฒ SecureStorage
           โ
ะัะธ ะบะฐะถะดะพะผ ะทะฐะฟัะพัะต ะดะพะฑะฐะฒะปัะตััั Bearer token ะฒ ะทะฐะณะพะปะพะฒะพะบ
           โ
ะัะปะธ ะฟะพะปััะตะฝะฐ 401 ะพัะธะฑะบะฐ โ ะฐะฒัะพะผะฐัะธัะตัะบะธะน Refresh
           โ
ะะพะฒัะพั ะพัะธะณะธะฝะฐะปัะฝะพะณะพ ะทะฐะฟัะพัะฐ ั ะฝะพะฒัะผ ัะพะบะตะฝะพะผ
```

**ะัะฐะฝัั ัะตะฐะปะธะทะฐัะธะธ:**

- `ApiService.SendWithRetry()` ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปัะตั ัะพะบะตะฝ ะฟัะธ 401 ะพัะธะฑะบะต
- ะ `DEBUG` ะบะพะฝัะธะณััะฐัะธะธ ะธัะฟะพะปัะทัะตััั ะปะพะบะฐะปัะฝัะน API ะฐะดัะตั ะธะท `Constants.cs`
- ะ `RELEASE` ะบะพะฝัะธะณััะฐัะธะธ ะธัะฟะพะปัะทัะตััั ะฐะดัะตั ะธะท `Preferences` (ะฟะพะทะฒะพะปัะตั ะผะตะฝััั ัะตัะฒะตั ะฑะตะท ะฟะตัะตะบะพะผะฟะธะปััะธะธ)
- Refresh ัะพะบะตะฝ ะพัะฟัะฐะฒะปัะตััั ะฒ ัะตะปะต POST ะทะฐะฟัะพัะฐ ะฝะฐ `/refresh`

**โ๏ธ ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั:**

- ะะพะฑะฐะฒะธัั ะผะตัะฐะฝะธะทะผ ะฟัะพะฐะบัะธะฒะฝะพะณะพ ะพะฑะฝะพะฒะปะตะฝะธั ัะพะบะตะฝะฐ (ะทะฐ 1-2 ะผะธะฝััั ะดะพ ะธััะตัะตะฝะธั)
- ะะตะฐะปะธะทะพะฒะฐัั ะปะพะณะธัะพะฒะฐะฝะธะต ะฟะพะฟััะพะบ refresh ะดะปั ะพัะปะฐะดะบะธ
- ะะพะฑะฐะฒะธัั ะผะฐะบัะธะผะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ะฟะพะฟััะพะบ refresh ะฟะตัะตะด ะฒััะพะดะพะผ ะธะท ะฟัะธะปะพะถะตะฝะธั

**ะคะฐะนะปั:** `LoginViewModel.cs`, `AuthHelper.cs`, `Auth.cs`, `ApiService.cs`

---

### ๐ฅ ะะฐัััะตะปั ะฟัะพัะธะปะตะน ะธ ะฟะพะธัะบ ั ัะธะปัััะฐัะธะตะน

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**

- ะะฐัััะตะปั ัะฒะฐะนะฟะฐ ะดะปั ะฟัะพัะผะพััะฐ ะฟัะพัะธะปะตะน
- ะัะธะผะตะฝะตะฝะธะต ะผะฝะพะถะตััะฒะตะฝะฝัั ัะธะปัััะพะฒ (ะฟะพะป, ะฒะพะทัะฐัั, ะผะตััะพะฟะพะปะพะถะตะฝะธะต, ัะฐัััะพัะฝะธะต)
- ะกะพััะฐะฝะตะฝะธะต ัะธะปัััะพะฒ ะผะตะถะดั ัะตะฐะฝัะฐะผะธ
- ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะฟะพะทะธัะธะธ ัะฒะฐะนะฟะฐ (undo ััะฝะบัะธั)

**ะะปัะฑะพะบะฐั ะปะพะณะธะบะฐ ัะฐะฑะพัั:**

#### 1. ะะฝะธัะธะฐะปะธะทะฐัะธั ัะธะปัััะพะฒ

```csharp
// ะัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต ัะธะปัััั ะทะฐะฟะพะปะฝััััั ะดะฐะฝะฝัะผะธ ะฟะพะปัะทะพะฒะฐัะตะปั
Filter = new SearchFilter
{
    InterestedIn = me.Gender,           // ะะฐะบะพะน ะฟะพะป ะธัะตั ะฟะพะปัะทะพะฒะฐัะตะปั
    Gender = me.InterestedIn,           // ะะพะป ะฟะพะปัะทะพะฒะฐัะตะปั
    MinAge = me.Age - 1,
    MaxAge = me.Age + 1,
    Latitude = me.Latitude,             // ะขะตะบััะตะต ะผะตััะพะฟะพะปะพะถะตะฝะธะต
    Longitude = me.Longitude,
    MaxDistanceKm = 10,                 // ะะฐะดะธัั ะฟะพะธัะบะฐ
};
StorageHelper.SaveSearchFilter(Filter); // ะกะพััะฐะฝะธัั ะฒ ะปะพะบะฐะปัะฝะพะต ััะฐะฝะธะปะธัะต
```

#### 2. ะกัััะบัััะฐ ะดะฐะฝะฝัั ะฟะพะธัะบะฐ

ะัะฟะพะปัะทัะตััั **LimitedDeque** (ะดะฒัััะพัะพะฝะฝัั ะพะณัะฐะฝะธัะตะฝะฝะฐั ะพัะตัะตะดั):

- **ะัะฝะพะฒะฝะพะน ะฑััะตั:** ะผะฐะบัะธะผัะผ 50 ะฟัะพัะธะปะตะน ะดะปั ัะฒะฐะนะฟะฐ
- **Undo ะฑััะตั:** ะฟะพัะปะตะดะฝะธะต 5 ะดะตะนััะฒะธะน ะผะพะถะฝะพ ะพัะผะตะฝะธัั
- **Current pointer:** ัะตะบััะธะน ะฟัะพัะผะฐััะธะฒะฐะตะผัะน ะฟัะพัะธะปั

```
[User1] โ [User2] โ [User3] (Current) โ [User4] โ [User5]
         โ_______UNDO BUFFER (5 items)_______โ
         โ___________MAIN BUFFER (50 items)____________โ
```

#### 3. ะะพะธัะบ ั ะฟะฐะณะธะฝะฐัะธะตะน

```csharp
const int PageSize = 20;  // ะะฐะฟัะฐัะธะฒะฐะตััั 20 ะฟัะพัะธะปะตะน ะทะฐ ัะฐะท
_lastSeenId              // ID ะฟะพัะปะตะดะฝะตะณะพ ะฟะพะปััะตะฝะฝะพะณะพ ะฟัะพัะธะปั (ะดะปั ะบัััะพัะฐ)

// ะะพะณะธะบะฐ:
1. ะะฐะฟัะพั ะธะดัั ัะพะปัะบะพ ะบะพะณะดะฐ ะฑััะตั ะทะฐะบะฐะฝัะธะฒะฐะตััั (< 5 ัะปะตะผะตะฝัะพะฒ)
2. ะัะฟัะฐะฒะปัะตััั ID ะฟะพัะปะตะดะฝะตะณะพ ะฟัะพัะธะปั ะดะปั ะฟะพะปััะตะฝะธั ัะปะตะดัััะตะน ะฟะฐััะธะธ
3. ะัะตะดะพัะฒัะฐัะฐะตั ะฑะตัะบะพะฝะตัะฝะพะต ะบะพะปะธัะตััะฒะพ ะทะฐะฟัะพัะพะฒ
4. ะัะธ _endReached = true ะฑะพะปััะต ะทะฐะฟัะพัะพะฒ ะฝะต ะธะดัั
```

**ะัะฐะฝัั:**

- ะคะธะปัััั ัะพััะฐะฝััััั ะฟัะธ ะบะฐะถะดะพะผ ะฟัะธะผะตะฝะตะฝะธะธ, ะฝะต ัะตัััััั ะฟัะธ ะฟะตัะตะทะฐะณััะทะบะต
- `LocationPlaceholder` ะฟะพะบะฐะทัะฒะฐะตั ะปะธะฑะพ ัะตะบััะธะน ะฒะฒะพะด, ะปะธะฑะพ ัะพััะฐะฝัะฝะฝะพะต ะผะตััะพะฟะพะปะพะถะตะฝะธะต

**โ๏ธ ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั:**

- ะะพะดะพะณะฝะฐัั ะทะฝะฐัะตะฝะธั ะฑััะตัะพะฒ, ัะฐะทะผะตัะฐ ัััะฐะฝะธัั ะธ ั.ะด.
- ะะพะฑะฐะฒะธัั ัะธะปัััะฐัะธั ะฟะพ ะธะฝัะตัะตัะฐะผ/ัะพะฑะฑะธ (ััะตะฑัะตั ัะฐััะธัะตะฝะธั `SearchFilter`)
- ะะตะฐะปะธะทะพะฒะฐัั "ัะผะฝัะน ะฟะพะธัะบ" โ ะตัะปะธ ะฟัะพัะธะปะตะน ะพััะฐะปะพัั ะผะฐะปะพ, ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฐััะธัััั ัะฐะดะธัั
- ะะฟัะธะผะธะทะธัะพะฒะฐัั ะทะฐะณััะทะบั ะฐะฒะฐัะฐัะพะฒ (ะทะฐะณััะถะฐัั ะฝะธะทะบะพะต ัะฐะทัะตัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั, ะฟะพะปะฝะพะต ะฟัะธ ะบะปะธะบะต)

**ะคะฐะนะปั:** `SearchViewModel.cs`, `SearchPage.xaml`, `LimitedDeque.cs`, `SearchFilter.cs`

---

### โค๏ธ ะกะธััะตะผะฐ ะปะฐะนะบะพะฒ ะธ ะผะฐััะตะน

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**

- ะัะฟัะฐะฒะบะฐ ะปะฐะนะบะฐ ะฟัะพัะธะปั
- ะัะพัะผะพัั ะฟะพะปััะตะฝะฝัั ะปะฐะนะบะพะฒ
- ะะฒัะพะผะฐัะธัะตัะบะธะต ัะฒะตะดะพะผะปะตะฝะธั ะพ ะฒะทะฐะธะผะฝัั ะปะฐะนะบะฐั (ะผะฐััะฐั)

**ะะพะณะธะบะฐ ะฒะทะฐะธะผะพะดะตะนััะฒะธั:**

```
ะะพะปัะทะพะฒะฐัะตะปั A ัะฒะฐะนะฟะฐะตั ะฒะฟัะฐะฒะพ ะฝะฐ ะะพะปัะทะพะฒะฐัะตะปั B
           โ
API endpoint: POST /swipe { target_id: userId, action: "like" }
           โ
ะกะตัะฒะตั ะฟัะพะฒะตััะตั: ะฐ ะฝะต ะปะฐะนะบะฝัะป ะปะธ B ัะถะต A?
           โ
                    โโ ะะ โ MATCH!
                    โ      ะะฑะต ััะพัะพะฝั ะฟะพะปััะฐัั ัะฒะตะดะพะผะปะตะฝะธะต ัะตัะตะท WebSocket
                    โ      ะกะพะทะดะฐัััั ัะฐั ะผะตะถะดั ะฝะธะผะธ
                    โ
                    โโ ะะะข โ ะฟัะพััะพ like
```

**ะัะฐะฝัั:**

- ะะพัะปะต ะพัะฟัะฐะฒะบะธ ะปะฐะนะบะฐ ะฟัะพัะธะปั ัะดะฒะธะณะฐะตััั ั ะบะฐัััะตะปะธ
- ะัะปะธ ะผะฐัั ะฟัะพะธะทะพะนะดัั, ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะพะบะฐะทัะฒะฐะตััั ะฐะปะตัั (ะธะท SocketService)
- ะกะธััะตะผะฐ ะฟัะตะดะพัะฒัะฐัะฐะตั ะดะฒะพะนะฝัะต ะปะฐะนะบะธ ัะตัะตะท API (400 Bad Request)

**โ๏ธ ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั:**

- ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปััั ัััะฐะฝะธัั ัะฐัะพะฒ ะฟัะธ ะฟะพะปััะตะฝะธะธ "match", ัะตะนัะฐั ะฝัะถะฝะพ ะฟัะพััะณะธะฒะฐัั ะฒะฝะธะท.
- ะะพะฑะฐะฒะธัั "ััะฟะตั ะปะฐะนะบ" ั ะดะพะฟะพะปะฝะธัะตะปัะฝัะผ ัะพะพะฑัะตะฝะธะตะผ
- ะะพะบะฐะทัะฒะฐัั ะฐะฝะฐะปะธัะธะบั: ะบัะพ ะปะฐะนะบะฝัะป, ะพัะบัะดะฐ, ะบะพะณะดะฐ

**ะคะฐะนะปั:** `LikesViewModel.cs`, `LikesPage.xaml`

---

### ๐ฌ ะงะฐัั ะธ ัะพะพะฑัะตะฝะธั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**

- ะกะฟะธัะพะบ ะฐะบัะธะฒะฝัั ัะฐัะพะฒ ั ะฟัะตะฒัั ะฟะพัะปะตะดะฝะธั ัะพะพะฑัะตะฝะธะน
- ะัะฟัะฐะฒะบะฐ ะธ ะฟะพะปััะตะฝะธะต ัะพะพะฑัะตะฝะธะน ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- WebSocket ัะธะฝััะพะฝะธะทะฐัะธั ะผะตะถะดั ะบะปะธะตะฝัะพะผ ะธ ัะตัะฒะตัะพะผ
- ะััะพัะธั ัะพะพะฑัะตะฝะธะน

**ะััะธัะตะบัััะฐ WebSocket:**

#### ะะฝะธัะธะฐะปะธะทะฐัะธั ะฟะพะดะบะปััะตะฝะธั:

```csharp
1. SocketService.ConnectAsync()
   โ
2. API ะทะฐะฟัะพั: POST /ws/start โ ะฟะพะปััะธัั sessionToken
   โ
3. WebSocket URL: ws://api.host/ws/chat?session={token}
   โ
4. ClientWebSocket.ConnectAsync() โ ะฟะพะดะบะปััะตะฝะธะต
   โ
5. ListenAsync() โ ัะพะฝะพะฒัะน ะฟะพัะพะบ ัะปััะฐะตั ะฒัะพะดััะธะต ัะพะพะฑัะตะฝะธั
```

#### ะะธะทะฝะตะฝะฝัะน ัะธะบะป ัะพะพะฑัะตะฝะธั:

```
ะะพะปัะทะพะฒะฐัะตะปั ะฟะตัะฐัะฐะตั ัะพะพะฑัะตะฝะธะต
           โ
ะะฐะถะธะผะฐะตั ะพัะฟัะฐะฒะธัั
           โ
SendMessageAsync() โ JSON ัะตัะธะฐะปะธะทะฐัะธั
           โ
ะัะฟัะฐะฒะบะฐ ะฒ WebSocket
           โ
ะกะตัะฒะตั ะพะฑัะฐะฑะฐััะฒะฐะตั ะธ ัะฐัััะปะฐะตั ะฐะดัะตัะฐัั
           โ
ListenAsync() ะฟะพะปััะฐะตั ัะพะฑััะธะต
           โ
ะะตัะตัะธะฐะปะธะทะฐัะธั JSON โ WSMessage
           โ
OnMessageReceived?.Invoke() โ ะฒัะต ะฟะพะดะฟะธััะธะบะธ ะฟะพะปััะฐัั ัะฒะตะดะพะผะปะตะฝะธะต
           โ
MessagesViewModel ะพะฑะฝะพะฒะปัะตั ObservableCollection
           โ
UI ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปัะตััั (ะฑะปะฐะณะพะดะฐัั MVVM binding)
```

**ะขะธะฟั WebSocket ัะพะฑััะธะน:**

- `Constants.Message` โ ัะตะบััะพะฒะพะต ัะพะพะฑัะตะฝะธะต
- `Constants.Match` โ ัะฒะตะดะพะผะปะตะฝะธะต ะพ ะผะฐััะต (ะฟะพะบะฐะทัะฒะฐะตััั ะฐะปะตัั)

**ะัะฐะฝัั ัะตะฐะปะธะทะฐัะธะธ:**

1. **ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ:**

   - ะัะธ ะพัะธะฑะบะต ะดะตัะตัะธะฐะปะธะทะฐัะธะธ ะฟะพะบะฐะทัะฒะฐะตััั ะฐะปะตัั ั ัะพะดะตัะถะธะผัะผ JSON
   - ะัะธ ัะฐะทััะฒะต ัะพะตะดะธะฝะตะฝะธั ะฟัะตะดะฟัะธะฝะธะผะฐะตััั ะฟะพะฟััะบะฐ ะฟะพะฒัะพัะฝะพะณะพ ะฟะพะดะบะปััะตะฝะธั

2. **ะกะพััะพัะฝะธะต ะฟะพะดะบะปััะตะฝะธั:**
   - ะะปะพะฑะฐะปัะฝัะน ัะปะฐะณ `_isConnected` ะฟัะตะดะพัะฒัะฐัะฐะตั ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะพะดะบะปััะตะฝะธั ะฟัะธ ัะผะตะฝะต ะฟะพะปัะทะพะฒะฐัะตะปั

**โ๏ธ ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั:**

- ะะตะฐะปะธะทะพะฒะฐัั "heartbeat" ะฟะธะฝะณะธ ะดะปั ะฟัะพะฒะตัะบะธ ะถะธะฒะพะณะพ ัะพะตะดะธะฝะตะฝะธั
- ะะพะฑะฐะฒะธัั ะธะฝะดะธะบะฐัะพั ััะฐัััะฐ ะฟะพะดะบะปััะตะฝะธั ะฒ UI (connected/disconnected)
- ะกะพััะฐะฝััั ัะพะพะฑัะตะฝะธั ะปะพะบะฐะปัะฝะพ, ะตัะปะธ ัะพะตะดะธะฝะตะฝะธะต ะฟะพัะตััะฝะพ, ะพัะฟัะฐะฒะปััั ะฟัะธ ะฒะพัััะฐะฝะพะฒะปะตะฝะธะธ
- ะะพะฑะฐะฒะธัั ัะธััะพะฒะฐะฝะธะต ัะพะพะฑัะตะฝะธะน ะฝะฐ ััะพัะพะฝะต ะบะปะธะตะฝัะฐ

**ะคะฐะนะปั:** `ChatsViewModel.cs`, `MessagesViewModel.cs`, `SocketService.cs`, `WSMessage.cs`

---

### ๐ ะะตะพะปะพะบะฐัะธั ะธ ัะตัะฒะธั ะผะตััะพะฟะพะปะพะถะตะฝะธั

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**

- ะะฟัะตะดะตะปะตะฝะธะต ัะตะบััะตะณะพ ะผะตััะพะฟะพะปะพะถะตะฝะธั ััััะพะนััะฒะฐ
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฟัะตะดะตะปะตะฝะธะต ะณะพัะพะดะฐ/ัััะฐะฝั
- ะัะตะดะปะพะถะตะฝะธั ะปะพะบะฐัะธะน ะฟัะธ ะฒะฒะพะดะต
- ะคะธะปัััะฐัะธั ะฟะพ ัะฐัััะพัะฝะธั ะดะพ ะดััะณะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

**ะะพะณะธะบะฐ ัะฐะฑะพัั:**

```
LocationService.GetCurrentLocationAsync()
           โ
ะะฐะฟัะพั ัะฐะทัะตัะตะฝะธั ั ะะก (ะฟะตัะฒัะน ัะฐะท)
           โ
GPS ะผะพะดัะปั ะพะฟัะตะดะตะปัะตั ะบะพะพัะดะธะฝะฐัั (Latitude, Longitude)
           โ
ะะฑัะฐัะฝัะน ะณะตะพะบะพะดะธะฝะณ โ ะะฐะทะฒะฐะฝะธะต ะณะพัะพะดะฐ (ัะตัะตะท API)
           โ
ะกะพััะฐะฝะธัั ะฒ ะฟัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั
           โ
ะัะฟะพะปัะทะพะฒะฐัั ะฒ ัะธะปัััะฐั ะฟะพะธัะบะฐ
```

**ะะฒัะพะดะพะฟะพะปะฝะตะฝะธะต ะปะพะบะฐัะธะน:**

```
ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั "ะะพั..."
           โ
LocationService.SearchLocationsAsync("ะะพั")
           โ
API ะทะฐะฟัะพั ะบ ัะตัะฒะธัั ะณะตะพะบะพะดะธัะพะฒะฐะฝะธั
           โ
LocationSuggestion[] ะฒะพะทะฒัะฐัะฐัััั ะฒ Suggestions
           โ
UI ะฟะพะบะฐะทัะฒะฐะตั ัะฟะธัะพะบ: "ะะพัะบะฒะฐ", "ะะพััะพัะฝะฐั", ะธ ั.ะด.
           โ
ะัะธ ะฒัะฑะพัะต: Location = "ะะพัะบะฒะฐ", Latitude/Longitude ะพะฑะฝะพะฒะปััััั
```

**ะัะฐะฝัั:**

- ะะฐะทะฝัะต ัะฐะทัะตัะตะฝะธั ะดะปั Android/iOS (ััะตะฑัะตั ะฟะปะฐััะพัะผะตะฝะฝัะน ะบะพะด ะฒ `/Platforms/`)
- ะะพะถะตั ััะตะฑะพะฒะฐัั ะฝะตัะบะพะปัะบะพ ัะตะบัะฝะด ะฟัะธ ะฟะตัะฒะพะผ ะพะฟัะตะดะตะปะตะฝะธะธ
- ะกะพััะฐะฝัะตััั ะฒ `Preferences` ะดะปั ะฟะพัะปะตะดัััะธั ัะตะฐะฝัะพะฒ

**โ๏ธ ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั:**

- ะะพะฑะฐะฒะธัั fallback ะฝะฐ IP-based ะณะตะพะปะพะบะฐัะธั (ะตัะปะธ GPS ะฝะต ะดะพัััะฟะตะฝ)
- ะะตะฐะปะธะทะพะฒะฐัั ะบััะธัะพะฒะฐะฝะธะต ัะตะทัะปััะฐัะพะฒ ะฟะพะธัะบะฐ ะปะพะบะฐัะธะน
- ะะพะฑะฐะฒะธัั ะฒะพะทะผะพะถะฝะพััั ัะบัััั ัะพัะฝะพะต ะผะตััะพะฟะพะปะพะถะตะฝะธะต (ะฟะพะบะฐะทัะฒะฐัั ะณะพัะพะด/ัะตะณะธะพะฝ, ะฝะพ ะฝะต ัะฐัััะพัะฝะธะต)

**ะคะฐะนะปั:** `LocationService.cs`, `LocationSuggestion.cs`, `Platforms/`

---

### โ๏ธ ะะฐัััะพะนะบะธ ะฟัะพัะธะปั ะธ ะฟัะธะฒะฐัะฝะพััั

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**

- ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะปะธัะฝะพะน ะธะฝัะพัะผะฐัะธะธ (ะธะผั, ะฒะพะทัะฐัั, ะฟะพะป, ะธะฝัะตัะตัั)
- ะะทะผะตะฝะตะฝะธะต ะฟัะตะดะฟะพััะตะฝะธะน ะฟะพะธัะบะฐ (ะฒะพะทัะฐัั, ะฟะพะป, ัะฐัััะพัะฝะธะต)

**ะะพะณะธะบะฐ ะพะฑะฝะพะฒะปะตะฝะธั ะฟัะพัะธะปั:**

```
ะะพะปัะทะพะฒะฐัะตะปั ะธะทะผะตะฝัะตั ะฟะพะปะต (ะฝะฐะฟัะธะผะตั, ะฝะธะบ)
           โ
SettingsViewModel.OnPropertyChanged()
           โ
RelayCommand ััะฐะฑะฐััะฒะฐะตั ะฟัะธ ัะพััะฐะฝะตะฝะธะธ
           โ
API ะทะฐะฟัะพั: PUT /profile { ะฟะพะปั ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั }
           โ
ะกะตัะฒะตั ะฒะพะทะฒัะฐัะฐะตั ะพะฑะฝะพะฒะปัะฝะฝัะน ะฟัะพัะธะปั
           โ
ะะพะบะฐะปัะฝัะน ะบัั ะพะฑะฝะพะฒะปัะตััั (CacheService)
           โ
UI ะพัะพะฑัะฐะถะฐะตั ะฝะพะฒัะต ะทะฝะฐัะตะฝะธั
```

**ะัะฐะฝัั:**

- ะัะต ะธะทะผะตะฝะตะฝะธั ัะพััะฐะฝััััั ะฝะฐ ัะตัะฒะตั (ะฝะตั ะปะพะบะฐะปัะฝะพะณะพ "ัะตัะฝะพะฒะธะบะฐ")
- ะัะธ ะพัะธะฑะบะต ะทะฐะณััะทะบะธ ะดะฐะฝะฝัะต ะพัะบะฐััะฒะฐัััั ะบ ะฟะพัะปะตะดะฝะธะผ ะธะทะฒะตััะฝัะผ
- ะะทะพะฑัะฐะถะตะฝะธั ะทะฐะณััะถะฐัััั ะพัะดะตะปัะฝะพ ัะตัะตะท multipart/form-data

**โ๏ธ ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั:**

- ะะตะฐะปะธะทะพะฒะฐัั ัะฟัะฐะฒะปะตะฝะธะต ะฐะฒะฐัะฐัะพะผ ะธ ัะพัะพะณัะฐัะธัะผะธ
- ะะพะฑะฐะฒะธัั ะปะพะบะฐะปัะฝะพะต ััะฐะฝะธะปะธัะต ัะตัะฝะพะฒะธะบะพะฒ ะฟัะพัะธะปั ะฟะตัะตะด ะพัะฟัะฐะฒะบะพะน
- ะะตะฐะปะธะทะพะฒะฐัั ะพะฟัะธะผะธััะธัะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต UI (ะธะทะผะตะฝะธัั ะปะพะบะฐะปัะฝะพ, ะฟะพัะพะผ ัะธะฝััะพะฝะธะทะธัะพะฒะฐัั)
- ะะพะฑะฐะฒะธัั ะฒะฐะปะธะดะฐัะธั ะฝะฐ ะบะปะธะตะฝัะต ะฟะตัะตะด ะพัะฟัะฐะฒะบะพะน
- ะะพะบะฐะทัะฒะฐัั ะธะฝะดะธะบะฐัะพั "ะธะทะผะตะฝะตะฝะธั ะฝะต ัะพััะฐะฝะตะฝั"
- ะะตะฐะปะธะทะพะฒะฐัั ะธััะพัะธะธ ะธะทะผะตะฝะตะฝะธะน ะฟัะพัะธะปั
- ะะพะฑะฐะฒะธัั ะดะฒัััะฐะบัะพัะฝัั ะฐััะตะฝัะธัะธะบะฐัะธั ะดะปั ะบัะธัะธัะฝัั ะพะฟะตัะฐัะธะน

**ะคะฐะนะปั:** `SettingsViewModel.cs`, `SettingsPage.xaml`

## ะััะธัะตะบัััะฐ ะธ ัะตัะฒะธัั ะดะฐะฝะฝัั

### 1๏ธโฃ ApiService.cs โ REST API ะบะปะธะตะฝั

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะดะธะฝะฐั ัะพัะบะฐ ะดะพัััะฟะฐ ะบะพ ะฒัะตะผั REST API, ัะฟัะฐะฒะปะตะฝะธะต HTTP ัะพะตะดะธะฝะตะฝะธะตะผ, ัะพะบะตะฝะฐะผะธ ะธ ะฟะพะฒัะพัะฝัะผะธ ะฟะพะฟััะบะฐะผะธ.

**ะะธะทะฝะตะฝะฝัะน ัะธะบะป ะทะฐะฟัะพัะฐ:**

```
1. HTTP ะทะฐะฟัะพั ะธะฝะธัะธะธััะตััั
   โ
2. AddAuthHeader() ะดะพะฑะฐะฒะปัะตั Bearer token
   โ
3. SendWithRetry() ะฒัะฟะพะปะฝัะตั ะทะฐะฟัะพั
   โ
4. ะกัะฐััั 200-299? โ ััะฟะตั, ะฒะตัะฝััั ัะตะทัะปััะฐั
   โ
5. ะกัะฐััั 401? โ ะฟะพะฟััะบะฐ ะพะฑะฝะพะฒะธัั ัะพะบะตะฝ
   โโ ะฃัะฟะตัะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต โ ะฟะพะฒัะพัะธัั ะทะฐะฟัะพั
   โโ ะัะธะฑะบะฐ ะพะฑะฝะพะฒะปะตะฝะธั โ ะฒะตัะฝััั 401 (ะฝัะถะตะฝ ะฝะพะฒัะน ะฒัะพะด)
   โ
6. ะััะณะธะต ะพัะธะฑะบะธ โ ะฒะตัะฝััั HttpResponseMessage
```

**ะะปััะตะฒัะต ะฝัะฐะฝัั:**

1. **Debug vs Release ะบะพะฝัะธะณััะฐัะธั:**

   - ะ DEBUG ะธัะฟะพะปัะทัะตััั ะปะพะบะฐะปัะฝัะน ะฐะดัะตั ะธะท `Constants.ApiBaseUrl`
   - ะ RELEASE ะธัะฟะพะปัะทัะตััั ะฐะดัะตั ะธะท `Preferences` (ะผะพะถะฝะพ ะผะตะฝััั ะฑะตะท ะฟะตัะตะบะพะผะฟะธะปััะธะธ)
   - ะญัะพ ะฟะพะทะฒะพะปัะตั ะพะดะฝะพะน ัะฑะพัะบะพะน ะฟะพะดะดะตัะถะธะฒะฐัั ัะฐะทะฝัะต ัะตัะฒะตัั

2. **ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ัะพะบะตะฝะฐ:**

   - ะัะธ 401 ะพัะธะฑะบะต ะฟััะฐะตััั ะพะฑะฝะพะฒะธัั ัะพะบะตะฝ ัะตัะตะท `/refresh` endpoint
   - ะะพะฒัะพััะตั ะทะฐะฟัะพั ะพะดะธะฝ ัะฐะท ั ะฝะพะฒัะผ ัะพะบะตะฝะพะผ
   - ะัะปะธ ะพะฑะฝะพะฒะปะตะฝะธะต ะฝะต ัะดะฐะปะพัั โ 401 ะฟะพะปัะทะพะฒะฐัะตะปั

3. **ะัะพะฑะปะตะผั ะธ ัะตะบะพะผะตะฝะดะฐัะธะธ:**
   - โ ะะตั exponential backoff (ัะพะปัะบะพ 1 retry)
   - โ ะะตั ะฝะฐัััะพะนะบะธ timeout (ะผะพะถะตั ะฒะธัะตัั 100 ัะตะบ)
   - โ ะััััััะฒัะตั ะปะพะณะธัะพะฒะฐะฝะธะต ะทะฐะฟัะพัะพะฒ (ัะปะพะถะฝะพ ะพัะปะฐะถะธะฒะฐัั)
   - โ **FIX:** ะะพะฑะฐะฒะธัั loggin ะธ exponential backoff
   - โ **FIX:** ะฃััะฐะฝะพะฒะธัั timeout = 10 ัะตะบ ะดะปั ะฑััััะพะณะพ fail

**ะคะฐะนะปั:** `ApiService.cs`, `Constants.cs`

---

### 2๏ธโฃ CacheService.cs โ ะะฒััััะพะฒะฝะตะฒะพะต ะบััะธัะพะฒะฐะฝะธะต

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะฟัะธะผะธะทะฐัะธั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ัะตัะตะท ะปะพะบะฐะปัะฝะพะต ะบััะธัะพะฒะฐะฝะธะต ะฟัะพัะธะปะตะน.

**ะััะธัะตะบัััะฐ:**

```
Level 1: ConcurrentDictionary (RAM) โ ะฑััััะพ (~1ms), ะฝะพ ัะตััะตััั ะฟัะธ ะฟะตัะตะทะฐะณััะทะบะต
                    โ
Level 2: SQLite (Disk) โ ะผะตะดะปะตะฝะฝะตะต (~50-100ms), ะฝะพ ะฟะตััะธััะตะฝัะตะฝ
                    โ
Level 3: API (Network) โ ัะฐะผัะน ะผะตะดะปะตะฝะฝัะน (~500-2000ms)
```

**ะะธะทะฝะตะฝะฝัะน ัะธะบะป ะทะฐะฟัะพัะฐ ะฟัะพัะธะปั:**

```
1. ะััั ะฒ RAM ะธ ะฝะต ัััะฐัะตะป (< 2 ะดะฝะตะน)? โ ะฒะตัะฝััั (~1ms)
2. ะะตั? ะััั ะฒ SQLite ะธ ะฝะต ัััะฐัะตะป?  โ ะทะฐะณััะทะธัั ะฒ RAM ะธ ะฒะตัะฝััั (~50ms)
3. ะะตั? ะะฐะณััะทะธัั ั API โ ัะพััะฐะฝะธัั ะฒ ะพะฑะฐ ะบััะฐ (~500ms+)
4. ะัะธะฑะบะฐ API? โ ะฒะตัะฝััั ะทะฐะณะปััะบั ะธะปะธ ะฟะพัะปะตะดะฝะธะน ะธะทะฒะตััะฝัะน ะฟัะพัะธะปั
```

**ะะฟัะธะผะธะทะฐัะธั ั ะฐะฒะฐัะฐัะฐะผะธ:**

- ะัะธ ะฟะพะปััะตะฝะธะธ ะฟัะพัะธะปั ะทะฐะณััะถะฐะตััั ะฐะฒะฐัะฐั ะพะดะธะฝ ัะฐะท
- URL ะทะฐะผะตะฝัะตััั ะฝะฐ ะปะพะบะฐะปัะฝัะน ะฟััั (ะธะท `AvatarCacheService`)
- ะะตะทัะปััะฐั: 95%+ ััะฐัะธะบะฐ ัะพััะฐะฝัะตััั ะฟัะธ ะทะฐะณััะทะบะต

**ะัะพะฑะปะตะผะฐ:**

- ะัั ะดะตะนััะฒัะตั 2 ะดะฝั โ ะตัะปะธ ะฟัะพัะธะปั ะธะทะผะตะฝะธะปัั, ะฟะพะปัะทะพะฒะฐัะตะปั ัะฒะธะดะธั ััะฐััะต ะดะฐะฝะฝัะต
- ะะตะบะพะผะตะฝะดะฐัะธั: ะธัะฟะพะปัะทะพะฒะฐัั ัะฐะทะฝัะต TTL ะดะปั ัะฐะทะฝัั ัะธะฟะพะฒ ะดะฐะฝะฝัั

**ะคะฐะนะปั:** `CacheService.cs`, `IUpdatable.cs`

---

### 3๏ธโฃ SocketService.cs โ WebSocket ะดะปั ัะตะฐะป-ัะฐะนะผะฐ

**ะะฐะทะฝะฐัะตะฝะธะต:** ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพััะพัะฝะฝัะผ ัะพะตะดะธะฝะตะฝะธะตะผ ะดะปั ัะพะพะฑัะตะฝะธะน ะฒ ัะฐัะฐั ะธ ัะฒะตะดะพะผะปะตะฝะธะน.

**ะฆะธะบะป ะฟะพะดะบะปััะตะฝะธั:**

```csharp
1. ะะฐะฟัะพั session token: POST /ws/start
2. ะัะตะพะฑัะฐะทะพะฒะฐัั HTTP โ WebSocket URL
3. ClientWebSocket.ConnectAsync()
4. ะะฐะฟัััะธัั ัะพะฝะพะฒัะน ListenAsync() (ะฝะต ะฑะปะพะบะธััะตั UI)
5. ะกะปััะฐัั ะฒัะพะดััะธะต ัะพะพะฑัะตะฝะธั ะฒ ัะธะบะปะต
```

**โ๏ธ ะะะะขะะงะะซะ ะะะะะะะะซ:**

1. **ะะตั heartbeat ะฟะธะฝะณะพะฒ**

   - ะัะพะบัะธะธ ะผะพะณัั ัะฐะทะพัะฒะฐัั "ะผะตััะฒะพะต" ัะพะตะดะธะฝะตะฝะธะต
   - ะัะถะฝะพ ะพัะฟัะฐะฒะปััั ะฟะธะฝะณ ะบะฐะถะดัะต 120 ัะตะบ ะดะปั ะฟัะพะฒะตัะบะธ ะถะธะฒะพะณะพ ัะพะตะดะธะฝะตะฝะธั

**ะคะฐะนะปั:** `SocketService.cs`, `WSMessage.cs`

---

### 4๏ธโฃ AvatarCacheService.cs โ ะะฟัะธะผะธะทะฐัะธั ะธะทะพะฑัะฐะถะตะฝะธะน

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะพะบะฐะปัะฝะพะต ะบััะธัะพะฒะฐะฝะธะต ะฐะฒะฐัะฐัะพะฒ ะดะปั ัะฝะธะถะตะฝะธั ััะฐัะธะบะฐ.

**ะะพะณะธะบะฐ:**

```
AvatarUrl: "https://api.host/avatars/user123.jpg"
     โ
GetAvatarPathAsync(url)
     โโ ะะฐ ะดะธัะบะต? โ ะฒะตัะฝััั ะปะพะบะฐะปัะฝัะน ะฟััั
     โโ ะะตั? โ ะทะฐะณััะทะธัั, ัะพััะฐะฝะธัั, ะฒะตัะฝััั
     โ
UI ะธัะฟะพะปัะทัะตั ะปะพะบะฐะปัะฝัะน ะฟััั (0 ััะฐัะธะบะฐ ะฟัะธ ะฟะพะฒัะพัะต)
```

**ะญะบะพะฝะพะผะธั ััะฐัะธะบะฐ:**

- ะะตัะฒัะน ะฟัะพัะผะพัั ะฟัะพัะธะปั: 50-200KB
- ะะพะฒัะพัะฝัะน ะฟัะพัะผะพัั: 0KB (ะธะท ะบััะฐ)
- **ะะตะทัะปััะฐั:** 95%+ ัะฑะตัะตะถะตะฝะธะต ะฟัะธ ะฟัะพะบัััะบะต

**โ๏ธ ะฃะปัััะตะฝะธั:**

- ะะพะฑะฐะฒะธัั ัะถะฐัะธะต ะธะทะพะฑัะฐะถะตะฝะธะน ะฟัะธ ัะพััะฐะฝะตะฝะธะธ
- ะะตะฐะปะธะทะพะฒะฐัั ะปะธะผะธั ัะฐะทะผะตัะฐ ะบััะฐ (ัะดะฐะปััั ััะฐััะต, ะตัะปะธ > 100MB)
- ะัะฟะพะปัะทะพะฒะฐัั WebP ะดะปั ะผะตะฝััะตะณะพ ัะฐะทะผะตัะฐ ัะฐะนะปะพะฒ

**ะคะฐะนะปั:** `AvatarCacheService.cs`

---

### 5๏ธโฃ LocationService.cs โ ะะตะพะปะพะบะฐัะธั

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะฟัะตะดะตะปะตะฝะธะต ะผะตััะพะฟะพะปะพะถะตะฝะธั, ะฟะพะธัะบ ะฟะพ ะบะพะพัะดะธะฝะฐัะฐะผ, ะฐะฒัะพะดะพะฟะพะปะฝะตะฝะธะต.

**ะัะพัะตัั:**

```
1. GetCurrentLocationAsync()
   โ
2. ะะฐะฟัะพั ัะฐะทัะตัะตะฝะธั ะะก (ะฟะตัะฒัะน ัะฐะท)
   โ
3. GPS ะพะฟัะตะดะตะปัะตั Latitude/Longitude (~5-50ะผ ัะพัะฝะพััั)
   โ
4. ะะฑัะฐัะฝัะน ะณะตะพะบะพะดะธะฝะณ: ะบะพะพัะดะธะฝะฐัั โ ะฝะฐะทะฒะฐะฝะธะต ะณะพัะพะดะฐ (optional)
   โ
5. ะกะพััะฐะฝะธัั ะฒ ะฟัะพัะธะปั
```

**ะัะฐะฝัั:**

- ะขัะตะฑัะตั ะฟะปะฐััะพัะผะตะฝะฝัะน ะบะพะด ะฒ `/Platforms/Android/` ะธ `/Platforms/iOS/`
- ะะพะธัะบ ะปะพะบะฐัะธะน ัะฐะฑะพัะฐะตั ัะตัะตะท API ะฐะฒัะพะดะพะฟะพะปะฝะตะฝะธะต

**โ๏ธ ะฃะปัััะตะฝะธั:**

- ะะพะฑะฐะฒะธัั fallback ะฝะฐ IP-based ะปะพะบะฐัะธั (ะฝะต ััะตะฑัะตั GPS ัะฐะทัะตัะตะฝะธั)
- ะััะธัะพะฒะฐัั ะบะพะพัะดะธะฝะฐัั, ะพะฑะฝะพะฒะปััั ัะพะปัะบะพ ะตัะปะธ > 1ะบะผ ะพัะบะปะพะฝะตะฝะธั
- ะะพะฑะฐะฒะธัั ัะฐัััั ัะฐัััะพัะฝะธั (Haversine formula)
- ะะพะบะฐะทัะฒะฐัั ัะฐัััะพัะฝะธะต ะฝะฐ ะบะฐััะฐั

**ะคะฐะนะปั:** `LocationService.cs`, `LocationSuggestion.cs`

## ะะพัะพะบ ะดะฐะฝะฝัั ะธ ัะธะฝััะพะฝะธะทะฐัะธั

### ะะฐัััะตะปั ะฟัะพัะธะปะตะน (SearchViewModel)

**ะะฝะธัะธะฐะปะธะทะฐัะธั:**

```
App ะทะฐะฟััะบะฐะตััั
    โ
MauiProgram ัะตะณะธัััะธััะตั Services (DI)
    โ
SearchPage ัะพะทะดะฐัั SearchViewModel
    โ
SearchViewModel ะบะพะฝััััะบัะพั:
    โโ ะะฐะณััะถะฐะตั ะฟะพัะปะตะดะฝะธะต ัะธะปัััั ะธะท StorageHelper
    โโ ะัะปะธ ะฟะตัะฒัะน ะทะฐะฟััะบ: ะทะฐะฟะพะปะฝัะตั ัะธะปัััั ะดะฐะฝะฝัะผะธ ะฟะพะปัะทะพะฒะฐัะตะปั
    โโ ะัะทัะฒะฐะตั LoadUsersAsync()
    โ   โโ API ะทะฐะฟัะพั: GET /users/search?filter...&lastId=null&pageSize=20
    โ   โโ ะะพะปััะฐะตั ะฟะตัะฒัะต 20 ะฟัะพัะธะปะตะน
    โ   โโ ะะพะฑะฐะฒะปัะตั ะฒ LimitedDeque
    โ   โโ CurrentUser ัะบะฐะทัะฒะฐะตั ะฝะฐ ะฟะตัะฒะพะณะพ
    โโ UI ะพัะพะฑัะฐะถะฐะตั CurrentUser
```

**ะัะธ ัะฒะฐะนะฟะต ะฒะฟัะฐะฒะพ (Like):**

```
ะะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั ะบะฝะพะฟะบั Like
    โ
LikeCommand ะฒัะฟะพะปะฝัะตั LikeUserAsync()
    โโ IsLoading = true (UI ะฟะพะบะฐะทัะฒะฐะตั spinner)
    โโ API ะทะฐะฟัะพั: POST /swipe { target_id: userId, action: "like" }
    โโ ะัะปะธ ััะฟะตั:
    โ   โโ _deque.MoveNext() (ะฟะตัะตะผะตััะธัั ัะบะฐะทะฐัะตะปั)
    โ   โโ CurrentUser ะพะฑะฝะพะฒะปัะตััั
    โ   โโ OnPropertyChanged() โ UI ะพะฑะฝะพะฒะปัะตััั
    โ   โโ ะัะปะธ ะพััะฐะปะพัั < 5 ะฟัะพัะธะปะตะน โ ะทะฐะณััะทะธัั ะตัั
    โโ IsLoading = false (UI ัะบััะฒะฐะตั spinner)
```

**ะะฟัะธะผะธะทะฐัะธั ะทะฐะณััะทะบะธ:**

```
ะะพะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ัะผะพััะธั ะฟัะพัะธะปะธ, ัะพะฝะพะฒะฐั ะทะฐะณััะทะบะฐ ัะฐะฑะพัะฐะตั:

ะัะพัะธะปั 1 (ัะผะพััะธั)
ะัะพัะธะปั 2-15 (ะทะฐะณััะถะตะฝั, ะฒ ะฟะฐะผััะธ)
ะัะพัะธะปั 16-20 (ะทะฐะณััะถะตะฝั, ะฒ ะฟะฐะผััะธ)
    โ
ะะพะณะดะฐ ะพััะฐัััั 5 ะฟัะพัะธะปะตะน:
    โ
ะคะพะฝะพะฒัะน ะทะฐะฟัะพั: GET /users/search?...&lastId=20&pageSize=20
    โ
ะัะพัะธะปั 21-40 ะทะฐะณััะถะฐัััั ะฒ ัะพะฝ (ะฝะต ะฑะปะพะบะธััั UI)
    โ
ะ ะผะพะผะตะฝัั, ะบะพะณะดะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ัะฒะฐะนะฟะฝัั ะดะพ 15-ะณะพ, 21-40 ัะถะต ะณะพัะพะฒั
```

### ะงะฐัั ะธ ัะพะพะฑัะตะฝะธั (MessagesViewModel + SocketService)

**ะะพะดะบะปััะตะฝะธะต:**

```
ะะพะปัะทะพะฒะฐัะตะปั ะพัะบััะฒะฐะตั ัะฐั
    โ
MessagesViewModel.OnAppearing()
    โ
SocketService.ConnectAsync()
    โโ ะัะปะธ ัะถะต ะฟะพะดะบะปััะตะฝะพ โ return (guard clause)
    โโ POST /ws/start โ ะฟะพะปััะธัั sessionToken
    โโ ะัะตะพะฑัะฐะทะพะฒะฐัั URL: http://api:8088 โ ws://api:8088/ws/chat?session=TOKEN
    โโ ClientWebSocket.ConnectAsync()
    โโ ะะฐะฟัััะธัั _ = ListenAsync() (ัะพะฝะพะฒัะน ะฟะพัะพะบ)
    โโ _isConnected = true
```

**ะะพะปััะตะฝะธะต ัะพะพะฑัะตะฝะธั:**

```
ะััะณะพะน ะฟะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะปัะตั ัะพะพะฑัะตะฝะธะต
    โ
ะกะตัะฒะตั ะพัะฟัะฐะฒะปัะตั ัะตัะตะท WebSocket
    โ
ListenAsync() ะฟะพะปััะฐะตั ะดะฐะฝะฝัะต ะฒ ัะธะบะปะต
    โโ ะัะตะพะฑัะฐะทะพะฒะฐัั bytes โ JSON โ WSMessage ะพะฑัะตะบั
    โโ ะัะปะธ Type == "message":
    โ   โโ OnMessageReceived?.Invoke(msg)  (ัะฒะตะดะพะผะธัั ะฟะพะดะฟะธััะธะบะพะฒ)
    โโ ะัะปะธ Type == "match":
        โโ DisplayAlert("Match!" ...) (ะฟะพะบะฐะทะฐัั ะฐะปะตัั)
```

**MessagesViewModel ะพะฑัะฐะฑะฐััะฒะฐะตั ะฒัะพะดััะตะต ัะพะพะฑัะตะฝะธะต:**

```
OnMessageReceived ัะพะฑััะธะต ะฒัะทัะฒะฐะตั MessageReceived()
    โ
MessageReceived(message):
    โโ ะกะพะทะดะฐัั Message ะพะฑัะตะบั ะธะท WSMessage
    โโ Messages.Add(message) (ObservableCollection)
    โโ ObservableCollection ัะฒะตะดะพะผะปัะตั UI ะพะฑ ะธะทะผะตะฝะตะฝะธะธ
    โโ UI ะฟัะพะบัััะธะฒะฐะตั ะดะพ ะฟะพัะปะตะดะฝะตะณะพ ัะพะพะฑัะตะฝะธั (ScrollToEnd)
```

**ะัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธั:**

```
ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั ัะตะบัั ะธ ะฝะฐะถะธะผะฐะตั ะพัะฟัะฐะฒะธัั
    โ
SendCommand ะฒัะฟะพะปะฝัะตั SendMessageAsync()
    โโ CurrentMessage = "" (ะพัะธััะธัั ะฟะพะปะต ะฒะฒะพะดะฐ)
    โโ ะกะพะทะดะฐัั WSMessage { Type="message", Content="...", ChatId=... }
    โโ SocketService.SendMessageAsync() โ ัะตัะธะฐะปะธะทะพะฒะฐัั ะฒ JSON
    โโ ะัะฟัะฐะฒะธัั ัะตัะตะท WebSocket (await)
    โโ ะะพะฑะฐะฒะธัั ัะพะพะฑัะตะฝะธะต ะฒ ะปะพะบะฐะปัะฝัะน Messages ัะฟะธัะพะบ
    โโ UI ะพะฑะฝะพะฒะปัะตััั (LocalMessage ะฟะพะบะฐะทัะฒะฐะตััั ัะธะฝััะพะฝะฝะพ, ะฝะต ะดะพะถะธะดะฐััั ัะตัะฒะตัะฐ)
    โโ ะกะตัะฒะตั ะฟะตัะตััะปะฐะตั ะฐะดัะตัะฐัั (ะธั SocketService ะฟะพะปััะธั)
```

### ะััะธัะพะฒะฐะฝะธะต ะฟัะพัะธะปะตะน (CacheService)

**ะะตัะฒัะน ะฟัะพัะผะพัั ะฟัะพัะธะปั:**

```
SearchViewModel ะฟะพะปััะฐะตั ะฟัะพัะธะปั ั API
    โ
CacheService.GetOrFetchUserProfileAsync(userId)
    โโ ะัะพะฒะตัะธัั RAM ะบัั (_userProfileCache) โ ะฝะต ะฝะฐะนะดะตะฝะพ
    โโ ะัะพะฒะตัะธัั SQLite ะบัั โ ะฝะต ะฝะฐะนะดะตะฝะพ
    โโ ะะฐะณััะทะธัั ั API
    โโ ะัะปะธ ะตััั ะฐะฒะฐัะฐั:
    โ   โโ AvatarCacheService.GetAvatarPathAsync()
    โ       โโ ะะฐ ะดะธัะบะต? โ ะฒะตัะฝััั ะฟััั
    โ       โโ ะะตั? โ ะทะฐะณััะทะธัั, ัะพััะฐะฝะธัั, ะฒะตัะฝััั
    โโ ะกะพััะฐะฝะธัั ะฒ RAM ะบัั (ะฑััััะพ)
    โโ ะกะพััะฐะฝะธัั ะฒ SQLite (ัะพะฝะพะผ, ะฝะต ะฑะปะพะบะธััะตั UI)
    โโ ะะตัะฝััั ะฟัะพัะธะปั
```

**ะะพะฒัะพัะฝัะน ะฟัะพัะผะพัั ัะพะณะพ ะถะต ะฟัะพัะธะปั:**

```
CacheService.GetOrFetchUserProfileAsync(userId)
    โโ ะัะพะฒะตัะธัั RAM ะบัั โ ะะะะะะะ ะธ ะฝะต ัััะฐัะตะปะพ
    โโ ะะตัะฝััั ะธะท RAM (~1ms)
       โ
    ะะฒะฐัะฐั ัะถะต ะฒ ะฟะฐะผััะธ, ะฝะต ัะบะฐัะธะฒะฐะตััั
```

**ะงะตัะตะท 2 ะดะฝั:**

```
CacheService.GetOrFetchUserProfileAsync(userId)
    โโ ะัะพะฒะตัะธัั RAM ะบัั โ ะะะะะะะ ะฝะพ ัััะฐัะตะปะพ (IsExpired = true)
    โโ ะัะพะฒะตัะธัั SQLite ะบัั โ ะะะะะะะ ะฝะพ ัััะฐัะตะปะพ
    โโ ะะฐะณััะทะธัั ัะฒะตะถะธะต ะดะฐะฝะฝัะต ั API
    โโ ะะฑะฝะพะฒะธัั ะพะฑะฐ ะบััะฐ
```

---

## ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะพะฟัะธะผะธะทะฐัะธะธ

### 1. ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

- โ ะัะฟะพะปัะทะพะฒะฐัั `ConcurrentDictionary` ะดะปั ะฟะพัะพะบะพะฑะตะทะพะฟะฐัะฝะพััะธ
- โ ะััะธัะพะฒะฐัั ะฐะฒะฐัะฐัั ะฝะฐ ะดะธัะบ (ัะบะพะฝะพะผะธั 95% ััะฐัะธะบะฐ)
- โ ะะฐะณะธะฝะธัะพะฒะฐัั ัะตะทัะปััะฐัั ะฟะพะธัะบะฐ (ะฝะต ะทะฐะณััะถะฐัั ะฒัั ัะฐะทะพะผ)
- โ **ะะทะฑะตะณะฐัั:** `.GetAwaiter().GetResult()` ะฒ ะบะพะฝััััะบัะพัะต (ะทะฐะผะพัะฐะถะธะฒะฐะตั UI)
- โ **ะะทะฑะตะณะฐัั:** ะกะธะฝััะพะฝะฝัะต ะพะฟะตัะฐัะธะธ ั ะะ ะฝะฐ ะพัะฝะพะฒะฝะพะผ ะฟะพัะพะบะต

### 2. ะะฐะดัะถะฝะพััั

- โ ะะพะฑะฐะฒะธัั retry ะปะพะณะธะบั ั exponential backoff ะดะปั API
- โ ะะตะฐะปะธะทะพะฒะฐัั ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะฟะตัะตะฟะพะดะบะปััะตะฝะธะต WebSocket
- โ ะะฑัะฐะฑะฐััะฒะฐัั ะผะฝะพะณะพะฟะฐะบะตัะฝัะต ัะพะพะฑัะตะฝะธั WebSocket
- โ **ะะทะฑะตะณะฐัั:** ะัะพะฑัะฐะถะตะฝะธะต ะฐะปะตััะพะฒ ะดะปั ะบะฐะถะดะพะน ะพัะธะฑะบะธ (ัะฐะทะดัะฐะถะฐะตั ะฟะพะปัะทะพะฒะฐัะตะปั)

### 3. ะะตะทะพะฟะฐัะฝะพััั

- โ ะัะฟะพะปัะทะพะฒะฐัั Bearer ัะพะบะตะฝั ะฒ Authorization ะทะฐะณะพะปะพะฒะบะต
- โ ะะฑะฝะพะฒะปััั ัะพะบะตะฝ ะฟะตัะตะด ะธััะตัะตะฝะธะตะผ
- โ **ะะทะฑะตะณะฐัั:** ะกะพััะฐะฝะตะฝะธะต ะฟะฐัะพะปั ะฒ Preferences
- โ **ะะทะฑะตะณะฐัั:** ะัะฟัะฐะฒะบะฐ ัะตะฝัะธัะธะฒะฝัั ะดะฐะฝะฝัั ะฒ ะปะพะณะฐั

### 4. UX

- โ ะะพะบะฐะทัะฒะฐัั `ActivityIndicator` ะฟัะธ ะทะฐะณััะทะบะต
- โ ะกะพััะฐะฝััั ัะธะปัััั ะธ ะฟะพะทะธัะธั ะผะตะถะดั ัะตะฐะฝัะฐะผะธ
- โ ะัะตะดะพััะฐะฒะปััั offline mode (ะฟะพะบะฐะทัะฒะฐัั ะบััะธัะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต)
- โ **ะะทะฑะตะณะฐัั:** ะะปะธัะตะปัะฝัะต ะพะฟะตัะฐัะธะธ ะฑะตะท ะธะฝะดะธะบะฐัะพัะฐ ะฟัะพะณัะตััะฐ

---

## Build ะธ ัะฐะทะฒะตัััะฒะฐะฝะธะต

### ะะปั Android

```bash
# Debug
dotnet publish -f net8.0-android -c Debug

# Release
dotnet publish -f net8.0-android -c Release
```

**ะััะพะดะฝะพะน ัะฐะนะป:** `bin/Release/net8.0-android/com.companyname.datingclient.apk`

### ะะปั iOS

```bash
# ะขัะตะฑัะตััั macOS
dotnet publish -f net8.0-ios -c Release
```

## ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะัะพะฑะปะตะผะฐ: "Unable to connect to API"

**ะะตัะตะฝะธะต:**

- ะัะพะฒะตัััะต ะทะฝะฐัะตะฝะธะต `ApiBaseUrl` ะฒ `Constants.cs`
- ะฃะฑะตะดะธัะตัั, ััะพ API ัะตัะฒะตั ะทะฐะฟััะตะฝ ะธ ะดะพัััะฟะตะฝ
- ะัะพะฒะตัััะต ัะตัะตะฒะพะต ัะพะตะดะธะฝะตะฝะธะต ััััะพะนััะฒะฐ

### ะัะพะฑะปะตะผะฐ: "WebSocket connection failed"

**ะะตัะตะฝะธะต:**

- ะัะพะฒะตัััะต URL WebSocket ัะตัะฒะตัะฐ
- ะฃะฑะตะดะธัะตัั, ััะพ ะฟะพัั ะพัะบััั ะฒ ัะฐะนะตัะฒะพะปะต
- ะัะพะฒะตัััะต ะปะพะณะธ SocketService

---